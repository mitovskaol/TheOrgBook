<section id="cred-form" class="page-min-height" *ngIf="(result$ | async) as result">
  <loading-indicator [loading]="result.loading"></loading-indicator>
  <error-message [error]="result.error"></error-message>

  <div class="row" *ngIf="result.data as record">
    <div class="col-sm-12" *ngIf="(verify$ | async) as verify">
      <h1 class="cred-title">{{record.credential_type.description}}</h1>

      <a [routerLink]="record.topic.link | localize" class="title-back-link mb-3">
        <span class="fa fa-arrow-left"></span> {{'topic.return-link' | translate}}</a>

      <div class="cred-info">

        <div class="row form-group" *ngIf="record.inactive">
          <div class="col-sm-12">
            <div class="alert alert-warning">
              <h3 translate>cred.inactive</h3>
              <p translate>cred.inactive-message</p>
            </div>
          </div>
        </div>

        <div class="row form-group" *ngIf="record.revoked">
          <div class="col-sm-12">
            <div class="alert alert-danger">
              <h3 translate>cred.expired</h3>
              <p translate>cred.expired-message</p>
            </div>
          </div>
        </div>

        <div class="row form-group" *ngIf="record.credential_type">
          <div class="col-sm-12">
            <label class="control-label" translate>cred.cred-type</label>
            <div class="form-field">
              {{record.credential_type.description}}
            </div>
          </div>
        </div>

        <div class="row form-group" *ngIf="record.issuer">
          <div class="col-sm-12">
            <label class="control-label" translate>cred.issuer</label>
            <div class="form-field">
              <a class="body-link issuer-link" [routerLink]="['/issuer', record.issuer.id] | localize">{{record.issuer.name}}</a>
            </div>
          </div>
        </div>

        <div class="row form-group" *ngIf="record.topic as topic">
          <div class="col-sm-12">
            <label class="control-label" translate>topic.related-to</label>
            <div class="form-field">
              {{topic.typeLabel | translate}}: <a class="body-link cred-link name" [routerLink]="topic.link | localize">{{topic.preferredName?.text}}</a>
              <br>{{'topic.source-id' | translate}}: <span class="text-identifier">{{topic.source_id}}</span>
            </div>
          </div>
        </div>

        <div class="row form-group" *ngIf="record.attributes?.length">
          <div class="col-sm-12">
            <label class="control-label" translate>cred.attributes</label>
            <div class="form-field attributes-outer">
              <attribute-list [records]="record.attributes"></attribute-list>
            </div>
          </div>
        </div>

        <div class="row form-group">
          <div class="col-sm-12">
            <label class="control-label" translate>cred.proof-of-claims</label>
            <loading-indicator [inline]="true" [loading]="verify.loading"></loading-indicator>
            <error-message [error]="verify.error"></error-message>
            <div class="form-field" *ngIf="verify.data as verifyResult">
              <span [class]="'proof-icon fa ' + (verifyResult.success ? 'fa-check-circle text-success' : 'fa-times-circle text-danger')"></span>
              <span>{{verifyResult.status | translate}}</span>
              <p *ngIf="! verifyResult.success" class="mt-2 mb-0">{{verifyResult.text}}</p>
            </div>
          </div>
        </div>

        <div class="row form-group">
          <div class="col-sm-12">
            <label class="control-label" translate>cred.start-date</label>
            <div class="form-field">
              <span class="claim-info date" *ngIf="record.effective_date">{{record.effective_date | dateFormat: 'effectiveDateTime'}}</span>
            </div>
          </div>
        </div>

        <div class="row form-group" *ngIf="record.create_timestamp">
          <div class="col-sm-12">
            <label class="control-label" translate>general.date-created</label>
            <div class="form-field">
              <span class="claim-info date" *ngIf="record.create_timestamp">{{record.create_timestamp | dateFormat: 'effectiveDateTime'}}</span>
            </div>
          </div>
        </div>

      <ng-container *ngIf="verify.data as verifyResult">
        <div class="card card-info mb-3">
          <div class="card-header expand-link" (click)="toggleShowClaims($event)">
            <h5 class="my-0">
              <span translate>cred.claims-proven</span>
              <span [class]="'expand-icon fa ' + (claimsVisible ? 'fa-chevron-up': 'fa-chevron-down')"></span>
            </h5>
          </div>
          <div class="card-body" *ngIf="claimsVisible">
            <div class="text-right">
              <a class="body-link verify-help" href="#">
                <span class="fa fa-question-circle"></span>
                <span translate>cred.whats-this-link</span>
              </a>
            </div>
            <div class="row claim-row" *ngFor="let claim of verifyResult.claims">
              <label class="col-sm-4 control-label text-right">{{claim.name}}</label>
              <div class="col-sm-8">{{claim.value}}</div>
            </div>
          </div>
        </div>

        <div class="card card-info">
          <div class="card-header expand-link" (click)="toggleShowProof($event)">
            <h5 class="my-0">
              <span translate>cred.proof-details</span>
              <span [class]="'expand-icon fa ' + (proofVisible ? 'fa-chevron-up': 'fa-chevron-down')"></span>
            </h5>
          </div>
          <div class="card-body" *ngIf="proofVisible">
            <div class="pull-right">
              <a class="body-link verify-help" href="#">
                <span class="fa fa-question-circle"></span>
                <span translate>cred.whats-this-link</span>
              </a>
            </div>
            <h3 class="mt-2" translate>cred.schema-info</h3>
            <div class="row">
              <label class="col-sm-3 control-label text-right" translate>schema.name</label>
              <div class="col-sm-9">{{record.credential_type.schema.name}}</div>
            </div>
            <div class="row">
              <label class="col-sm-3 control-label text-right" translate>schema.version</label>
              <div class="col-sm-9">{{record.credential_type.schema.version}}</div>
            </div>
            <ng-container *ngIf="verifyResult.success">
              <h3 class="mt-2" translate>cred.crypto-data</h3>
              <div class="verify-data"><pre>{{verifyResult.text}}</pre></div>
            </ng-container>
          </div>
        </div>
      </ng-container>

      </div>
    </div>

  </div>

</section>
